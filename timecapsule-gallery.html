<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Capsule Gallery - Stages</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #2a2a2a;
            color: white;
            padding: 20px;
            text-align: center;
            overflow-x: hidden; /* Prevent horizontal scroll from containers */
        }
        .header {
            color: #00ff88;
            margin-bottom: 20px;
            font-size: 32px;
        }
        .stage-section {
            background: #1a1a1a;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #333;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .stage-title {
            font-size: 22px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
            text-align: left;
            font-weight: 700;
        }
        #title-sealed { border-color: #667eea; color: #667eea; }
        #title-soon { border-color: #feca57; color: #feca57; }
        #title-open { border-color: #ff4444; color: #ff4444; }

        .capsule-list {
            display: flex;
            overflow-x: auto; /* Enable horizontal scrolling for stages */
            gap: 20px;
            padding-bottom: 10px;
            min-height: 150px; /* Ensure stages are visible even when empty */
        }
        /* Custom scrollbar for aesthetic */
        .capsule-list::-webkit-scrollbar { height: 8px; }
        .capsule-list::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        .capsule-card {
            min-width: 280px;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #444;
            flex-shrink: 0;
            text-align: left;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .capsule-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .capsule-card h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        .status {
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
            font-size: 12px;
            text-transform: uppercase;
        }
        .status.open { background: #ff4444; color: white; }
        .status.sealed { background: #00ff88; color: #000; }
        .detail { font-size: 13px; color: #ccc; margin-top: 3px; }
        .delete-btn {
            background: #333; color: #ff4444; border: 1px solid #ff4444; 
            padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;
            transition: background 0.2s;
        }
        .delete-btn:hover { background: #ff4444; color: white; }
        .back-button {
            margin-top: 30px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
    </style>
</head>
<body>
    <div class="header">‚è≥ My Time Capsule Gallery</div>
    <button class="back-button" onclick="location.href='timecapsule.html'">
        ‚Üê Create New Capsule
    </button>
    
    <div id="stage-open" class="stage-section">
        <div id="title-open" class="stage-title">üîì Stage 3: Ready to Open / Opened</div>
        <div id="capsule-container-open" class="capsule-list"></div>
    </div>

    <div id="stage-soon" class="stage-section">
        <div id="title-soon" class="stage-title">‚è≥ Stage 2: Opening Soon (Next 3 Months)</div>
        <div id="capsule-container-soon" class="capsule-list"></div>
    </div>

    <div id="stage-sealed" class="stage-section">
        <div id="title-sealed" class="stage-title">üîí Stage 1: Deeply Sealed</div>
        <div id="capsule-container-sealed" class="capsule-list"></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', loadCapsules);
        
        // Ï∫°Ïäê ÏÇ≠Ï†ú Î°úÏßÅ (Í∏∞Ï°¥ Î°úÏßÅ Ïú†ÏßÄ)
        function deleteCapsule(id) {
            if (!confirm("Ï†ïÎßêÎ°ú Ïù¥ ÌÉÄÏûÑÏ∫°ÏäêÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.")) {
                return;
            }
            
            let capsules = JSON.parse(localStorage.getItem('timeCapsules') || '[]');
            const updatedCapsules = capsules.filter(capsule => capsule.id !== id);
            localStorage.setItem('timeCapsules', JSON.stringify(updatedCapsules));
            
            loadCapsules(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        }

        // Ï∫°Ïäê Î™©Î°ù Î°úÎìú Î∞è Ïä§ÌÖåÏù¥ÏßÄ Î∂ÑÎ•ò Î°úÏßÅ (ÏàòÏ†ïÎê®)
        function loadCapsules() {
            // Ïª®ÌÖåÏù¥ÎÑà Ï¥àÍ∏∞Ìôî
            document.getElementById('capsule-container-open').innerHTML = '';
            document.getElementById('capsule-container-soon').innerHTML = '';
            document.getElementById('capsule-container-sealed').innerHTML = '';

            const capsules = JSON.parse(localStorage.getItem('timeCapsules') || '[]');
            const now = new Date();
            const threeMonthsInMs = 3 * 30 * 24 * 60 * 60 * 1000; // ÎåÄÎûµ 3Í∞úÏõî (ms)

            if (capsules.length === 0) {
                document.getElementById('capsule-container-sealed').innerHTML = '<p style="color: #888; padding-top: 10px;">No capsules buried yet.</p>';
                return;
            }

            capsules.forEach(capsule => {
                const openDate = new Date(capsule.openDate);
                const timeDiff = openDate - now; // ÎÇ®ÏùÄ ÏãúÍ∞Ñ (ms)
                const isOpened = timeDiff <= 0;
                
                let containerId;

                if (isOpened) {
                    containerId = 'capsule-container-open';
                } else if (timeDiff <= threeMonthsInMs) {
                    containerId = 'capsule-container-soon';
                } else {
                    containerId = 'capsule-container-sealed';
                }

                const statusClass = isOpened ? 'open' : 'sealed';
                const statusText = isOpened ? 'OPENED' : (timeDiff <= threeMonthsInMs ? 'SOON' : 'SEALED');
                const openDateDisplay = openDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                
                const totalParts = capsule.parts.length;
                const partsWithContent = capsule.parts.filter(p => p.contentData && p.contentData.content).length;
                
                const card = document.createElement('div');
                card.className = 'capsule-card';
                card.dataset.capsuleId = capsule.id;
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <span class="status ${statusClass}">${statusText}</span>
                        <button class="delete-btn" data-id="${capsule.id}">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                    <h3>${capsule.name}</h3>
                    <div class="detail">Open Date: <strong style="color: ${isOpened ? '#ff4444' : '#00ff88'}">${openDateDisplay}</strong></div>
                    <div class="detail">Total Parts: ${totalParts}</div>
                    <div class="detail">Content Items: ${partsWithContent}</div>
                    <div class="detail" style="margin-top: 10px;">
                        <a href="timecapsule-view.html?id=${capsule.id}" style="color: #667eea; text-decoration: none;">View Capsule ‚Üí</a>
                    </div>
                `;
                document.getElementById(containerId).appendChild(card);
            });

            // ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îêú ÏÇ≠Ï†ú Î≤ÑÌäºÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ìï†Îãπ
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const idToDelete = e.target.dataset.id;
                    deleteCapsule(idToDelete);
                });
            });
        }
    </script>
</body>
</html>
